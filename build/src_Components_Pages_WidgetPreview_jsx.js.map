{"version":3,"file":"src_Components_Pages_WidgetPreview_jsx.js?ver=acc9977a39f8d0eb6b31","mappings":"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","sources":["webpack://servv-plugin/./src/Components/Pages/WidgetPreview.jsx"],"sourcesContent":["import { useEffect, useState, useRef } from \"react\";\n\n/**\n * ✅ Servv Platform Widget Preview (Vue Widget in React)\n */\nexport default function WidgetPreview({ settings }) {\n  const [loaded, setLoaded] = useState(false);\n  const [error, setError] = useState(null);\n  const mountRef = useRef(false);\n\n  useEffect(() => {\n    if (mountRef.current) return;\n\n    /* ======================================================\n       ✅ 1. CRITICAL: Create mount element BEFORE script loads\n    ====================================================== */\n\n    // Ensure mount element exists first\n    if (!document.querySelector(\"#servv-platform-widget\")) {\n      console.error(\"❌ Mount element must exist before script injection!\");\n      setError(\"❌ Internal error: mount element timing issue\");\n      return;\n    }\n\n    console.log(\"✅ Mount element confirmed present\");\n\n    /* ======================================================\n       ✅ 2. Provide required WordPress globals\n    ====================================================== */\n\n    window.servvAjax = {\n      ajax_url: \"/wp-admin/admin-ajax.php\",\n      nonce: \"demo-nonce\",\n      assets_url: \"/wp-content/plugins/servv-wpse/widget/dist/\",\n    };\n\n    window.__SERVV_SETTINGS__ = settings || {};\n\n    console.log(\"✅ servvAjax injected:\", window.servvAjax);\n    console.log(\"✅ __SERVV_SETTINGS__ injected\");\n\n    /* ======================================================\n       ✅ 3. Asset URLs\n    ====================================================== */\n\n    const base = \"/wp-content/plugins/servv-wpse/widget/dist/\";\n    const scriptUrl = base + \"js/servv-widget.js\";\n    const cssUrl = base + \"css/servv-widget.css\";\n\n    /* ======================================================\n       ✅ 4. Inject Widget CSS\n    ====================================================== */\n\n    if (!document.getElementById(\"servv-css\")) {\n      const link = document.createElement(\"link\");\n      link.id = \"servv-css\";\n      link.rel = \"stylesheet\";\n      link.href = cssUrl;\n      document.head.appendChild(link);\n      console.log(\"✅ Widget CSS injected:\", cssUrl);\n    }\n\n    /* ======================================================\n       ✅ 5. Inject Widget Script\n    ====================================================== */\n\n    const existingScript = document.getElementById(\"servv-script\");\n\n    if (!existingScript) {\n      const script = document.createElement(\"script\");\n      script.id = \"servv-script\";\n      script.src = scriptUrl;\n      script.async = false; // Synchronous loading for predictable execution\n\n      script.onload = () => {\n        console.log(\"✅ Widget JS loaded successfully\");\n\n        // The widget auto-mounts when script loads\n        // Just verify it worked\n        setTimeout(() => {\n          const mountEl = document.querySelector(\"#servv-platform-widget\");\n\n          if (!mountEl) {\n            console.error(\"❌ Mount element disappeared!\");\n            setError(\"❌ Mount element not found\");\n            return;\n          }\n\n          // Check if Vue mounted\n          const hasContent =\n            mountEl.children.length > 0 ||\n            mountEl.__vue_app__ !== undefined ||\n            mountEl.innerHTML.trim().length > 0;\n\n          if (hasContent) {\n            console.log(\"✅ Widget auto-mounted successfully!\");\n            setLoaded(true);\n            mountRef.current = true;\n          } else {\n            console.warn(\n              \"⚠️ Widget loaded but not mounted. Trying manual mount...\",\n            );\n\n            // Fallback: manually call mount function\n            if (typeof window.ServvMountWidget === \"function\") {\n              try {\n                window.ServvMountWidget(\"#servv-platform-widget\");\n                console.log(\"✅ Manual mount successful\");\n                setLoaded(true);\n                mountRef.current = true;\n              } catch (err) {\n                console.error(\"❌ Manual mount failed:\", err);\n                setError(`❌ Mount failed: ${err.message}`);\n              }\n            } else {\n              setError(\"❌ Widget mount function not available\");\n            }\n          }\n        }, 300);\n      };\n\n      script.onerror = () => {\n        console.error(\"❌ Failed loading widget script:\", scriptUrl);\n        setError(\"❌ Widget script failed to load\");\n      };\n\n      document.body.appendChild(script);\n      console.log(\"✅ Widget Script injected:\", scriptUrl);\n    } else {\n      console.log(\"ℹ️ Widget script already exists\");\n\n      // Script already loaded, manually mount\n      setTimeout(() => {\n        const mountEl = document.querySelector(\"#servv-platform-widget\");\n\n        if (!mountEl) {\n          setError(\"❌ Mount element not found\");\n          return;\n        }\n\n        // Check if already mounted\n        const hasContent = mountEl.children.length > 0 || mountEl.__vue_app__;\n\n        if (hasContent) {\n          console.log(\"✅ Widget already mounted\");\n          setLoaded(true);\n          mountRef.current = true;\n        } else if (typeof window.ServvMountWidget === \"function\") {\n          try {\n            console.log(\"✅ Calling ServvMountWidget for re-mount\");\n            window.ServvMountWidget(\"#servv-platform-widget\");\n            setLoaded(true);\n            mountRef.current = true;\n          } catch (err) {\n            console.error(\"❌ Mount error:\", err);\n            setError(`❌ Mount failed: ${err.message}`);\n          }\n        } else {\n          setError(\"❌ Widget mount function not available\");\n        }\n      }, 100);\n    }\n\n    // Cleanup\n    return () => {\n      const mountEl = document.querySelector(\"#servv-platform-widget\");\n      if (mountEl && mountEl.__vue_app__) {\n        try {\n          mountEl.__vue_app__.unmount();\n          console.log(\"✅ Vue app unmounted\");\n        } catch (err) {\n          console.warn(\"⚠️ Unmount error:\", err);\n        }\n      }\n    };\n  }, [settings]);\n\n  return (\n    <div className=\"p-6 bg-gray-50 border rounded-xl space-y-4\">\n      <h2 className=\"text-lg font-semibold\">\n        Servv Widget Preview (React Admin)\n      </h2>\n\n      {/* ======================================================\n          ✅ Hidden WordPress DOM Inputs\n      ====================================================== */}\n\n      <div style={{ display: \"none\" }}>\n        <input id=\"servv_calendar_customer_id\" defaultValue=\"\" readOnly />\n        <input id=\"servv_calendar_customer_email\" defaultValue=\"\" readOnly />\n        <input\n          id=\"servv_calendar_customer_first_name\"\n          defaultValue=\"\"\n          readOnly\n        />\n        <input\n          id=\"servv_calendar_customer_last_name\"\n          defaultValue=\"\"\n          readOnly\n        />\n        <input\n          id=\"servv_calendar_shop_domain\"\n          defaultValue=\"demo-shop.myshopify.com\"\n          readOnly\n        />\n        <input\n          id=\"servv_calendar_signature\"\n          defaultValue=\"demo-signature\"\n          readOnly\n        />\n        <input\n          id=\"servv_calendar_default_filter_params\"\n          defaultValue=\"\"\n          readOnly\n        />\n      </div>\n\n      {/* ======================================================\n          ✅ CRITICAL: Mount element MUST exist before useEffect runs\n      ====================================================== */}\n\n      <div\n        id=\"servv-platform-widget\"\n        className=\"min-h-[500px] bg-white border rounded-xl shadow-sm\"\n      />\n\n      {/* ======================================================\n          ✅ Status Messages\n      ====================================================== */}\n\n      {!loaded && !error && (\n        <p className=\"text-sm text-gray-500 text-center\">\n          Loading widget preview...\n        </p>\n      )}\n\n      {loaded && (\n        <p className=\"text-sm text-green-600 text-center\">\n          ✅ Widget loaded successfully\n        </p>\n      )}\n\n      {error && (\n        <p className=\"text-sm text-red-600 text-center font-medium\">{error}</p>\n      )}\n    </div>\n  );\n}\n"],"names":["useEffect","useState","useRef","jsx","_jsx","jsxs","_jsxs","WidgetPreview","settings","loaded","setLoaded","error","setError","mountRef","current","document","querySelector","console","log","window","servvAjax","ajax_url","nonce","assets_url","__SERVV_SETTINGS__","base","scriptUrl","cssUrl","getElementById","link","createElement","id","rel","href","head","appendChild","existingScript","script","src","async","onload","setTimeout","mountEl","hasContent","children","length","__vue_app__","undefined","innerHTML","trim","warn","ServvMountWidget","err","message","onerror","body","unmount","className","style","display","defaultValue","readOnly"],"sourceRoot":""}